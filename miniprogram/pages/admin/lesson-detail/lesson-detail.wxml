<view class="container">
  <van-loading wx:if="{{ loading }}" size="24px" color="var(--accent-color)" vertical>加载中...</van-loading>

  <block wx:if="{{ !loading && lesson }}">
    <view class="status-bar">
      <van-tag
        type="{{ lesson.status === 'cancelled' ? 'danger' : lesson.status === 'completed' ? 'success' : 'primary' }}"
        size="large"
      >{{ statusLabels[lesson.status] }}</van-tag>
    </view>

    <view class="card detail-card">
      <view class="detail-title">{{ lesson.courseName }}</view>

      <view class="detail-row">
        <text class="detail-label">日期</text>
        <text class="detail-value">{{ lesson.date }}</text>
      </view>
      <view class="detail-row">
        <text class="detail-label">时间</text>
        <text class="detail-value">{{ lesson.startTime }} - {{ lesson.endTime }}</text>
      </view>
      <view class="detail-row">
        <text class="detail-label">老师</text>
        <text class="detail-value">{{ lesson.teacherName }}</text>
      </view>
      <view class="detail-row" wx:if="{{ lesson.location }}">
        <text class="detail-label">地点</text>
        <text class="detail-value">{{ lesson.location }}</text>
      </view>

      <view class="section-title" style="margin-top: var(--spacing-lg);">学生名单</view>
      <view class="student-list">
        <text
          wx:for="{{ lesson.studentNames }}"
          wx:key="*this"
          class="student-item"
        >{{ item }}</text>
      </view>
    </view>

    <!-- Feedback -->
    <view class="card feedback-card" wx:if="{{ feedback }}">
      <view class="section-title">老师反馈</view>
      <view class="feedback-content">{{ feedback.content }}</view>
      <view class="feedback-images" wx:if="{{ feedback.images && feedback.images.length > 0 }}">
        <image
          wx:for="{{ feedback.images }}"
          wx:key="*this"
          src="{{ item }}"
          mode="aspectFill"
          class="feedback-img"
          bind:tap="previewImage"
          data-url="{{ item }}"
          data-urls="{{ feedback.images }}"
        />
      </view>
    </view>

    <!-- Admin actions -->
    <view class="action-bar" wx:if="{{ lesson.status === 'scheduled' }}">
      <van-button custom-class="btn-primary-brand" round bind:click="goEdit">编辑</van-button>
      <van-button type="primary" custom-class="btn-accent" round bind:click="handleComplete">标记完成</van-button>
      <van-button type="danger" plain round bind:click="handleCancel">取消</van-button>
    </view>
  </block>

  <van-empty wx:if="{{ !loading && !lesson }}" description="课程不存在" />
  <van-dialog id="van-dialog" />
</view>
