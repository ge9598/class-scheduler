<view class="login-page">
  <view class="login-header">
    <view class="logo-placeholder">
      <text class="logo-text">EA</text>
    </view>
    <text class="brand-name">未来精英学院</text>
    <text class="subtitle">课程排课 · 上课提醒 · 课后反馈</text>
  </view>

  <!-- 阶段1：微信登录 -->
  <view class="login-actions" wx:if="{{ step === 'login' }}">
    <van-button
      type="primary"
      custom-class="btn-accent"
      block
      round
      loading="{{ loading }}"
      loading-text="登录中..."
      bind:click="handleLogin"
    >
      微信登录
    </van-button>
  </view>

  <!-- 阶段2：绑定手机号 / 切换身份 -->
  <view class="bind-section" wx:if="{{ step === 'bind' }}">
    <view class="bind-card">
      <view class="bind-tip">
        <van-icon name="info-o" size="16px" color="#49498e" />
        <text class="bind-tip-text" wx:if="{{ !isSwitchMode }}">首次登录需绑定手机号，请联系管理员确认已添加您的信息</text>
        <text class="bind-tip-text" wx:else>输入要切换的用户手机号</text>
      </view>

      <!-- 微信一键授权模式（仅首次绑定时显示） -->
      <view wx:if="{{ useWxPhoneAuth && !isSwitchMode }}" class="bind-actions">
        <button
          class="wx-phone-btn"
          open-type="getPhoneNumber"
          bindgetphonenumber="handleWxPhone"
        >
          微信授权绑定手机号
        </button>
        <view class="manual-link" bind:tap="showManualInput">
          <text>手动输入手机号</text>
        </view>
      </view>

      <!-- 手动输入手机号模式 -->
      <view wx:if="{{ !useWxPhoneAuth || isSwitchMode || showManual }}" class="bind-form">
        <van-field
          value="{{ phone }}"
          type="number"
          maxlength="{{ 11 }}"
          placeholder="请输入手机号"
          border="{{ false }}"
          bind:change="onPhoneChange"
          custom-class="phone-field"
        />
        <van-button
          type="primary"
          custom-class="btn-accent"
          block
          round
          loading="{{ binding }}"
          loading-text="{{ isSwitchMode ? '切换中...' : '绑定中...' }}"
          disabled="{{ phone.length !== 11 }}"
          bind:click="handleBindPhone"
        >
          {{ isSwitchMode ? '切换身份' : '绑定手机号' }}
        </van-button>
      </view>
    </view>

    <view class="back-link" bind:tap="handleBack">
      <text>返回重新登录</text>
    </view>
  </view>
</view>
